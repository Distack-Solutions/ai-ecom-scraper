{% extends 'volt/inc/base.html' %}

{% block extra_css %}
<style>
  /* Adjusting product title to wrap to a new line */
  .product-title {
    max-width: 300px;
    word-wrap: break-word; /* Break long words if necessary */
    white-space: normal; /* Allow wrapping of text to the next line */
  }

  /* Shimmer effect for images */
  .shimmer {
    background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
  }

  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }

  .thumbnail-wrapper {
    width: 100px;
    height: 100px;
    overflow: hidden;
    border-radius: 5px;
    position: relative;
  }

  .thumbnail-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none; /* Hide the image initially until it loads */
  }

  .thumbnail-wrapper.loading {
    background-color: #e0e0e0;
    position: relative;
  }


</style>
{% endblock %}


{% block content %}



<div class="pt-5 pb-4">
  <div class="d-flex justify-content-between w-100 flex-wrap">
    <div class="mb-3 mb-lg-0">
      <h1 class="h4">Products</h1>
    </div>

    <div class="gap-2 d-flex justify-content-end align-items-center">
      <!-- <button type="button" class="btn btn-primary px-4">Approve</button>
      <button type="button" class="btn btn-primary px-4 mx-2">Blacklist</button>

      <a 
        title="Approve"
        onclick="return confirm('Are you sure you want to publish these products?')" 
        class="btn btn-success p-1 px-2" href="#" role="button">
        <i class="material-icons my-0 py-0 align-middle fs-6">done</i>
      </a>

      <a 
        title="Delete"
        onclick="return confirm('Are you sure you want to delete this product?')" 
        class="btn btn-danger p-1 px-2" href="#" role="button">
          <i class="material-icons my-0 py-0 align-middle fs-6">delete</i>
        </a> -->
    </div>

  </div>
</div>

<div class="card border-light shadow-sm mb-4">
  <div class="card-body">
    <div class="d-flex align-items-center">
      <form class="navbar-search form-inline w-25 me-2" id="navbar-search-main">
        <div class="input-group input-group-merge search-bar">
          <input
            type="text"
            class="form-control"
            id="topbarInputIconLeft"
            placeholder="Search"
            aria-label="Search"
            aria-describedby="topbar-addon"
          />
        </div>
      </form>
      <button class="btn btn-dark">Filter</button>
    </div>


  </div>

  <div class="">
    <div class="card-body  border p-0">
      <div class="table-responsive">
        <table class="table table-centered table-nowrap mb-0">
          <thead class="thead-light">
            <tr>
              <th class="border-0">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" />
                </div>
              </th>
              <th class="border-0" style="width: 15%">Photo</th>
              <th class="border-0" style="max-width: 25%">Name</th>
              <th class="border-0">Status</th>
              <th class="border-0">Source Website</th>
              <th class="border-0">View Product</th>
            </tr>
          </thead>
          <tbody>
            {% if not products %}

            <tr class="border-bottom align-middle">
              <td class="border-0" colspan="6">
                <div class="text-center">
                  <p>No Product Available</p>
                </div>
              </td>
            </tr>
            {% endif %}


            <!-- Product Items -->
            {% for product in products %}
            <tr class="border-bottom align-middle">
              <td class="border-0">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" />
                </div>
              </td>
              <td class="border-0 fw-bold">
                <div class="thumbnail-wrapper loading shimmer">
                  <img
                    src="{{ product.thumbnail.url }}"
                    alt="{{ product.title }}"
                  />
                </div>
              </td>
              
              <td class="border-0 fw-bold">
                <h5 class="product-title" title="{{ product.title }}">
                  {{ product.title }}
                </h5>
                <div>
                  {% for category in product.get_categories %}
                    <span class="badge border bg-primary text-white p-1 px-2">{{category}}</span>  
                  {% endfor %}
                </div>
              </td>
              <td class="border-0">
                <span class="badge status-{{ product.status }} p-1 px-2">{{ product.get_status_display }}</span>
              </td>
              <td class="border-0 fw-bold">
                <img style="width: 100px;" src="{{ product.source_website.logo.url }}" alt="">
              </td>
              <td class="border-0 fw-bold">
                <a class="btn btn-light text-dark p-1 px-2" href="{% url 'scraper:product_detail' product.id %}" role="button">
                  <i class="material-icons my-0 py-0 align-middle fs-5">visibility</i>
                </a>
                <a name="" id="" class="btn btn-light text-success p-1 px-2" href="#" role="button">
                  <i class="material-icons my-0 py-0 align-middle fs-5">edit</i>
                </a>
                <a 
                onclick="return confirm('Are you sure you want to delete this product?')" 
                href="{% url 'scraper:delete-product' product.id %}"
                class="btn btn-light text-danger p-1 px-2" href="#" role="button">
                  <i class="material-icons my-0 py-0 align-middle fs-5">delete</i>
                </a>
                

              </td>
            </tr>
            {% endfor %}
            <!-- End of Product Items -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
  const thumbnails = document.querySelectorAll('.thumbnail-wrapper img');

  thumbnails.forEach(img => {
    // Listen for image load event
    img.onload = function() {
      img.style.display = 'block'; // Show the image when it's loaded
      const wrapper = img.closest('.thumbnail-wrapper');
      wrapper.classList.remove('loading'); // Remove loading class
      wrapper.classList.remove('shimmer'); // Remove shimmer effect
    };

    // Handle cases where image fails to load
    img.onerror = function() {
      const wrapper = img.closest('.thumbnail-wrapper');
      wrapper.classList.remove('loading'); // Ensure loading class is removed even on error
      wrapper.classList.remove('shimmer'); // Ensure shimmer effect is removed even on error
    };

    // In case the image is already cached and loaded
    if (img.complete) {
      img.onload();
    }
  });
});

</script>

{% endblock content %}
